---
title: "Haute densitÃ© (HiDPI) avec deux Ã©crans 4K sous Linux"
description: |
  J'ai achetÃ© deux Ã©crans haute densitÃ© Dell P2415Q pour ma station
  de travail. Le support sous Linux avec X11 laisse toujours Ã  dÃ©sirer.
uuid: f7942543-be8a-4733-b897-cab011639e7f
cover: dual-dell-p2415q@2x.jpg
tags:
  - desktop
---

J'utilise un portable [Lenovo Thinkpad X1 Carbon][] (210Â PPP) depuis
quatre ans ainsi qu'un tÃ©lÃ©phone [Nokia 8][] (550Â PPP) depuis un an.
J'apprÃ©cie la haute densitÃ© de leurs Ã©crans respectifs : le rendu du
texte est excellent. Pour obtenir des rÃ©sultats similaires avec ma
station de travail, j'ai achetÃ© une paire d'Ã©crans [Dell P2415Q][] :

![Deux Dell P2415Q]([[!!images/dual-dell-p2415q@2x.jpg]] "Configuration en Ã©crans doubles avec deux moniteurs Dell P2415Q")

# Ã‰crans

Le *Dell P2415Q* est un Ã©cran 24" dotÃ© d'un panneau IPS d'une
rÃ©solution de 3840Ã—2160 (185 PPP) et une couverture complÃ¨te de
l'espace de couleurs sRGB. Il est sorti en 2015 et son prix est
dÃ©sormais sous la barre des 400Â â‚¬. Il a reÃ§u des [critiques
positives][positive reviews].

L'une des unitÃ©s est arrivÃ© avec un pixel mort. Je pensais qu'il
s'agissait d'un problÃ¨me du passÃ©, mais la [politique de Dell
concernant les pixels morts][Dell policy on dead pixels] stipule :

> Lors du processus de fabrication des Ã©crans LCD, un ou plusieurs
> pixels se figent parfois dans un Ã©tat immuable. Un Ã©cran comportant
> de 1 Ã  5 sous-pixels figÃ©s est considÃ©rÃ© comme normal et conforme
> aux normes industrielles.

Un deuxiÃ¨me problÃ¨me est la prÃ©sence de lignes grises horizontales
(difficilement) visibles sur fond blanc. Le problÃ¨me [ne semble pas
Ãªtre rare][not be uncommon], mais Dell est peu enthousiaste Ã  ce
sujet. Si je m'assois correctement, les lignes deviennent invisibles.

Je suis un peu dÃ©Ã§u par ces aspects, mais je pense qu'ils restent
supportables et que c'est l'occasion de corriger mon obsession pour
ces dÃ©tails.

# Carte graphique

Pour piloter un Ã©cran 4K Ã  60Â Hz, il faut au moins un connecteur [HDMI
2.0][] ou [DisplayPort 1.2][]. Le *Dell P2415Q* a Ã©tÃ© [mis Ã  niveau
vers HDMI 2.0][upgraded to HDMI 2.0] en 2016 et dispose Ã©galement
d'une entrÃ©e DPÂ 1.2. Il y a un port pour chaÃ®ner un second Ã©cran, mais
en l'absence de prise en charge de DPÂ 1.3, le taux de rafraÃ®chissement
tomberait Ã  30Â Hz.

Il n'y a actuellement aucune carte Radeon disponible autour de 100Â â‚¬
et capable de piloter deux Ã©crans 4K. CÃ´tÃ© Nvidia, la [GeForce GT
1030][] convient avec une consommation de 20 W pour la version GDDR4.
J'ai optÃ© pour un [modÃ¨le Ã  refroidissement passif de MSI][passively
cooled model from MSI]. Sous Linux, le rÃ©sultat est assez dÃ©cevant :

 - Le [pilote *nouveau*][nouveau driver] n'a encore qu'une [prise en
   charge rudimentaire][rudimentary support] pour cette gÃ©nÃ©ration de
   puces Nvidia. Le rÃ©sultat est excessivement lent et le port
   HDMIÂ 2.0 n'est pas gÃ©rÃ© correctement.

 - Le [pilote propriÃ©taire Nvidia en version 390][proprietary Nvidia
   driver version 390] prÃ©sente des [problÃ¨mes de performance
   importants][important performance issues] qui le rendent
   inutilisable Ã  ces rÃ©solutions. Avec la [version 396][], la
   situation s'amÃ©liore, mais cela reste encore un peu poussif.
   J'utilise [Compton][] comme compositeur et j'ai passÃ© [beaucoup de
   temps][a lot of time] Ã  essayer d'obtenir de meilleures
   performances en utilisant le backend OpenGL, sans succÃ¨s. J'utilise
   maintenant le backend *XRender*. Je dois aussi activer
   [l'utilisation d'OpenGL][OpenGL compositing] dans Firefox.[^video]
   Je n'ai pas encore testÃ© la version 410.

[^video]: Sans ce paramÃ¨tre, il est impossible de lire une vidÃ©o HD ou
    4K dans Firefox. C'est un peu dommage que nous ne puissions
    toujours [pas obtenir un rendu vidÃ©o accÃ©lÃ©rÃ© sous Linux][unable
    to get accelerated video rendering on Linux] alors que d'autres
    plates-formes ont cette fonctionnalitÃ© depuis longtemps. Pour
    Chromium, des [patchs existent][patches exist] mais ne sont pas
    acceptÃ©s.

A l'avenir, je remplacerai peut-Ãªtre cette carte par une Radeon. Il
est difficile de dÃ©terminer si cela amÃ©liorera les
performances,[^perf] mais le pilote `amdgpu` sera certainement plus
stable et utilisable.

[^perf]: Par rapport Ã  ma configuration prÃ©cÃ©dente, le nombre de
    pixels est quadruplÃ©. La carte utilise 4 voies sur PCI 3.0, ce qui
    correspond Ã  une bande passante de 25 Gbits/s. Cela permet Ã  peine
    le transfert de 7680Ã—2160 pixels Ã  60 Hz en 24 bits. Ceci peut
    expliquer la difficultÃ© Ã  lire des vidÃ©os 4K sans accÃ©lÃ©ration.

# Prise en charge de la haute densitÃ© avec X11

Gnome et KDE prennent dÃ©sormais en charge les affichages Ã  haute
densitÃ© (*HiDPI*) sans configuration particuliÃ¨re sous X11. Pour les
autres environnements, le paramÃ©trage est assez simple, grÃ¢ce Ã 
[xsettingsd][]. Le code suivant doit Ãªtre invoquÃ© Ã  partir de
`~/.xsession` ou lorsque la densitÃ© change :

    ::shell
    # DensitÃ© cible
    dpi=192

    # Pour les applications supportant XSettings, `Xft/DPI' indique
    # l'Ã©chelle pour les fontes (et parfois pour le reste de l'interface),
    # `Gdk/WindowScalingFactor' indique l'Ã©chelle pour l'interface avec
    # GTK 3 et `Gdk/UnscaledDPI' annule l'Ã©chelle choisie pour les fontes
    # pour les applications GTK 3.
    > ~/.xsettingsd cat <<EOF
    Xft/DPI $(( $dpi*1024 ))
    Gdk/WindowScalingFactor $(( $dpi/96 ))
    Gdk/UnscaledDPI $(( $dpi*1024/($dpi/96) ))
    EOF
    pkill -HUP xsettingsd || xsettingsd &

    # Pour les applications QT.
    export QT_AUTO_SCREEN_SCALE_FACTOR=1

    # Pour certaines autres applications.
    echo Xft.dpi: $dpi | xrdb -merge

Ensuite, c'est Ã  chaque application de savoir comment effectuer le
rendu Ã  la densitÃ© choisie. Le tableau ci-dessous donne un aperÃ§u de
la prise en charge pour certaines d'entre elles, en utilisant les
paramÃ¨tres ci-dessus. Â«Â *Ã‰chelle du texte*Â Â» indique si une
application est capable d'adapter la taille du texte. C'est
gÃ©nÃ©ralement la fonctionnalitÃ© la plus essentielle. Â«Â *Ã‰chelle de
l'interface*Â Â» indique si elle est capable de mettre Ã  l'Ã©chelle
l'ensemble de l'interface, y compris les icÃ´nes. IdÃ©alement, les
applications devraient Ã©galement Ãªtre en mesure de changer
dynamiquement leurs paramÃ¨tres lorsqu'elles sont notifiÃ©es via
*XSettings*, ce qui est utile lors du passage sur un Ã©cran externe.

Application                   | Ã‰chelle du texte | Ã‰chelle de l'interface | Sans redÃ©marrage ?
--------------------          | ---------------- | ---------------------- | --------
Applications QTÂ 5             | âœ”ï¸            | âœ”ï¸                 | âœ”ï¸
Chromium[^chromium]           | âœ”ï¸            | âœ”ï¸                 | âœ”ï¸
Applications Electron[^electron] | âœ”ï¸            | âœ”ï¸                 | âœ”ï¸
Firefox                       | âœ”ï¸            | âœ”ï¸                 | âŒ
Blender[^blender]             | âœ”ï¸            | âœ”ï¸                 | âŒ
Emacs 26.1 (GTKÂ 3)            | âœ”ï¸            | ðŸ˜                 | âœ”ï¸
[Terminaux VTE][vte] (GTKÂ 3)  | âœ”ï¸            | ðŸ˜                 | âœ”ï¸
Applications GTKÂ 3            | âœ”ï¸            | ðŸ˜                 | âœ”ï¸
Gimp (GTKÂ 2)                  | âœ”ï¸            | âŒ                 | âœ”ï¸
Inkscape (GTKÂ 2)              | âœ”ï¸            | âŒ                 | âœ”ï¸
Applications GTKÂ 2            | âœ”ï¸            | âŒ                 | âœ”ï¸
Applications Java[^java]      | ðŸ™„            | ðŸ™„                 | âŒ
xterm and rxvt (avec Xft)     | âœ”ï¸            | n/a               | âŒ
Autres applications           | âŒ            | âŒ                 | âŒ

[^chromium]: Pour dÃ©tecter les changements, *Chromium* surveille les
    Ã©vÃ¨nements *RandR*. Ils peuvent Ãªtre capturÃ©s avant d'avoir pu
    mettre Ã  jour les variables *XSettings*.

[^electron]: Si cela ne fonctionne pas, essayez avec le drapeau
    `--force-device-scale-factor=2`.

[^blender]: *Blender* se base sur la valeur de la ressource `Xft.dpi`.

[^java]: Les applications Java doivent Ãªtre invoquÃ©es avec la variable
    d'environnement `GDK_SCALE=2`, sans quoi, aucune mise Ã  l'Ã©chelle
    n'est effectuÃ©e.

Les applications **QTÂ 5** offrent une excellente prise en charge. Les
applications **GTKÂ 3** ne peuvent utiliser qu'un coefficient
multiplicateur entier pour mettre Ã  l'Ã©chelle leurs interfaces, ce qui
est ennuyeux quand on a besoin d'un facteur 1.5Ã—. Les applications
**GTKÂ 2** ne savent adapter que la taille du texte. Elles sont
toujours assez nombreuses, avec notamment *Gimp*. Pour plus de
dÃ©tails, jetez un Å“il sur la page dÃ©diÃ©e au sujet sur [ArchWiki][].
Au-delÃ  de X11, [Wayland][] permet d'utiliser une densitÃ© diffÃ©rente
pour chaque Ã©cran et de mettre Ã  l'Ã©chelle les applications qui ne
savent pas prendre en charge les densitÃ©s Ã©levÃ©es.

En conclusion, la situation actuelle dÃ©pend Ã©normÃ©ment des
applications utilisÃ©es. Mes principales applications Ã©tant Firefox,
Emacs et un terminal basÃ© sur VTE, le rÃ©sultat me satisfait.

*[PPP]: Pixels par pouce
*[IPS]: In-Plane Switching

[Lenovo Thinkpad X1 Carbon]: https://www.thinkwiki.org/wiki/Category:X1_Carbon_2nd "ThinkPad X1 Carbon 2nd on ThinkWiki"
[Nokia 8]: https://en.wikipedia.org/wiki/Nokia_8 "Nokia 8 on Wikipedia"
[Dell P2415Q]: https://www.dell.com/en-us/shop/dell-24-ultra-hd-4k-monitor-p2415q/apd/210-agnk/monitors-monitor-accessories "Dell 24 Ultra HD 4K Monitor"
[positive reviews]: https://pcmonitors.info/reviews/dell-p2415q/ "Dell P2415Q on PC Monitors"
[Dell policy on dead pixels]: https://www.dell.com/support/article/us/en/19/sln130145/dell-lcd-display-pixel-guidelines?lang=fr "Instructions relatives aux pixels des Ã©crans LCD de Dell"
[not be uncommon]: https://www.dell.com/community/Desktops-General-Read-Only/P2415Q-faint-horizontal-grey-lines/td-p/5135894 "P2415Q, faint horizontal grey lines"
[HDMI 2.0]: https://en.wikipedia.org/wiki/HDMI#Refresh_frequency_limits_for_standard_video "HDMI: Refresh frequency limits for standard video"
[DisplayPort 1.2]: https://en.wikipedia.org/wiki/DisplayPort#Resolution_and_refresh_frequency_limits "DisplayPort: Refresh frequency limits"
[upgraded to HDMI 2.0]: https://www.dell.com/support/article/us/en/19/sln306595/setting-up-the-p2415q-p2715q-monitors-with-hdmi-20-that-support-4k-x-2k-60hz?lang=en "Setting Up the P2415Q / P2715Q Monitors with HDMI 2.0 that Support 4K x 2K 60Hz"
[GeForce GT 1030]: https://www.geforce.com/hardware/desktop-gpus/geforce-gt-1030/specifications "GeForce GT 1030 specifications"
[passively cooled model from MSI]: https://www.msi.com/Graphics-card/GeForce-GT-1030-2GHD4-LP-OC "MSI GeForce GT 1030 2GHD4 LP OC"
[nouveau driver]: https://nouveau.freedesktop.org "Nouveau: Accelerated Open Source driver for Nvidia cards"
[rudimentary support]: https://archive.is/2018/https://nouveau.freedesktop.org/wiki/FeatureMatrix/ "Feature matrix for the nouveau driver"
[important performance issues]: https://devtalk.nvidia.com/default/topic/1029484/linux/-various-all-distros-numerous-performance-amp-rendering-issues-on-390-25 "Numerous Performance & Rendering Issues on 390.25"
[Compton]: https://github.com/chjj/compton/ "A compositor for X11"
[OpenGL compositing]: https://wiki.archlinux.org/index.php/Firefox/Tweaks#Enable_OpenGL_Off-Main-Thread_Compositing_.28OMTC.29 "Firefox performance tweaks"
[patches exist]: https://chromium-review.googlesource.com/c/chromium/src/+/532294 "Chromium: Enable VAVDA, VAVEA and VAJDA on linux with VAAPI only"
[unable to get accelerated video rendering on Linux]: https://bugzilla.mozilla.org/show_bug.cgi?id=1210727 "Add VA-API hardware decoding support on Linux"
[xsettingsd]: https://github.com/derat/xsettingsd "Provides settings to X11 applications via the XSETTINGS specification"
[vte]: [[fr/blog/2017-ecrire-emulateur-terminal.html]] "Ã‰crire son propre Ã©mulateur de terminal"
[ArchWiki]: https://wiki.archlinux.org/index.php/HiDPI "HiDPI on ArchWiki"
[Wayland]: https://wayland.freedesktop.org/ "Wayland"
[a lot of time]: https://github.com/vincentbernat/awesome-configuration/commits/c7a3a44b378d6cca8de09b005d0200bc629e6796/xsession
[proprietary Nvidia driver version 390]: http://archive.is/CNvOT "nvidia-driver (390.87-2) in Debian Buster"
[version 396]: http://archive.is/mQRz8 "nvidia-driver (396.54-1)"

{# Local Variables:      #}
{# mode: markdown        #}
{# indent-tabs-mode: nil #}
{# End:                  #}
