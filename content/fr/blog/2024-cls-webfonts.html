---
title: "Correction des d√©calages visuels caus√©s par les polices web"
description: |
   La m√©trique ¬´ Cumulative Layout Shift ¬ª (CLS) mesure la stabilit√© visuelle
   d'une page web vis-√†-vis des changements de mise en page inattendus.
   Des propri√©t√©s CSS offrent une solution √† ces d√©calages caus√©s
   par les polices web.
uuid: fb72224d-4a1c-4148-8f2a-16793aabfe91
js:
  - 2024-cls-webfonts.js
css:
  - 2024-cls-webfonts.css
tags:
  - web
---

En 2020, Google a introduit les [m√©triques Core Web Vitals][] pour mesurer
certains aspects de l'exp√©rience utilisateur sur le web. Ce blog a constamment
obtenu de bons scores pour deux de ces m√©triques : [Largest Contentful Paint][]
et [Interaction to Next Paint][]. Cependant, l'optimisation de la troisi√®me
m√©trique, [Cumulative Layout Shift][], qui mesure les changements de mise en
page inattendus, a √©t√© plus difficile. Soyons honn√™tes : optimiser pour cette
m√©trique n'est pas vraiment utile pour un site comme celui-ci. Mais obtenir un
meilleur score est toujours une bonne distraction. üíØ

Pour √©viter le ¬´¬†flash de texte invisible¬†¬ª lors de l'utilisation de polices
web, les d√©veloppeurs sont encourag√©s √† placer la propri√©t√© `font-display` sur
`swap` dans les r√®gles `@font-face`. Cette m√©thode permet aux navigateurs
d'afficher initialement le texte en utilisant une police de substitution, puis
de la remplacer par la police finale lorsqu'elle est charg√©e. Bien que cela
am√©liore le score LCP, cela provoque des d√©calages de mise en page si les
polices de substitution n'ont pas des m√©triques compatibles. Ces d√©calages
affectent n√©gativement le score CLS. CSS fournit des propri√©t√©s pour r√©soudre ce
probl√®me en adaptant les m√©triques des polices de substitution :
[`size-adjust`][size-adjust], [`ascent-override`][ascent-override],
[`descent-override`][descent-override] et
[`line-gap-override`][line-gap-override].

Deux articles complets expliquent chaque propri√©t√© et leurs m√©thodes de calcul
en d√©tail : [Creating Perfect Font Fallbacks in CSS][] et [Improved font
fallbacks][].

# Outil interactif

Au lieu de calculer chaque propri√©t√© √† partir des m√©triques moyennes des
polices, j'ai cr√©√© un outil pour r√©gler interactivement les m√©triques des
polices de substitution.[^others]

[^others]: Des outils similaires existent d√©j√†, comme le [Fallback Font
    Generator][], mais il lui manque quelques fonctionnalit√©s, comme la
    possibilit√© de fournir la police de secours ou d'avoir des d√©cimales pour
    les propri√©t√©s CSS. Et pas de code source.

## Mode d'emploi

1. Chargez votre police personnalis√©e.

2. S√©lectionnez une police de substitution.

3. Ajustez la propri√©t√© `size-adjust` pour faire correspondre la largeur de
   votre police personnalis√©e avec celle de la police de substitution. Avec une
   police proportionnelle, il n'est souvent pas possible d'obtenir une correspondance
   parfaite.

4. Affinez la propri√©t√© `ascent-override`. Essayez d'aligner le point final du
   dernier paragraphe tout en surveillant la ligne de base de la police. Pour un
   ajustement plus pr√©cis, d√©sactivez l'option ¬´ <label
   for="lf1-support-line-height">D√©finir la hauteur de ligne</label>¬†¬ª.

5. Modifiez la propri√©t√© `descent-override`. L'objectif est de faire
   correspondre les deux bo√Ætes. Vous devrez peut-√™tre alterner entre cette
   propri√©t√© et la pr√©c√©dente pour obtenir des r√©sultats optimaux.

6. Si n√©cessaire, ajustez la propri√©t√© `line-gap-override`. Cette √©tape n'est
   g√©n√©ralement pas requise.

Le processus doit √™tre r√©p√©t√© pour chaque police de substitution. Certaines
plateformes peuvent ne pas inclure certaines polices. Notamment, Android n'a pas
la plupart des polices pr√©sentes dans d'autres syst√®mes d'exploitation. Il
remplace *Georgia* par *Noto Serif*, qui n'est pas compatible au niveau des
m√©triques.

## Outil

Cet outil n√©cessite JavaScript.
{.when-nojs}

<div class="when-js p" id="lf1-support-controls">
 <div>
  <label for="lf1-support-font-custom-file">Fichier de police personnalis√©e</label>
  <input type="file" id="lf1-support-font-custom-file" accept=".ttf,.otf,.woff,.woff2">
 </div>
 <div>
  <label for="lf1-support-font-fallback-select">Police de substitution</label>
  <select id="lf1-support-font-fallback-select">
    <option value="-lf1-font-fallback-file">Police personnalis√©e</option>
  </select>
 </div>
 <div>
  <label for="lf1-support-font-fallback-name">Nom de police de substitution</label>
  <input id="lf1-support-font-fallback-name">
 </div>
 <div>
  <label for="lf1-support-font-fallback-file">Fichier de police de substitution</label>
  <input type="file" id="lf1-support-font-fallback-file" accept=".ttf,.otf,.woff,.woff2">
 </div>

 <div>
  <label for="lf1-support-line-height">D√©finir la hauteur de ligne</label>
  <input type="checkbox" checked id="lf1-support-line-height">
 </div>

 <div>
  <label for="lf1-support-sizeAdjust"><code>size-adjust</code></label>
  <input type="range" id="lf1-support-sizeAdjust" min="0" max="200" value="100" step="0.1">
  <span id="lf1-support-sizeAdjust-value">100%</span>
 </div>

 <div>
  <label for="lf1-support-ascentOverride"><code>ascent-override</code></label>
  <input type="range" id="lf1-support-ascentOverride" min="0" max="200" value="100" step="0.1">
  <span id="lf1-support-ascentOverride-value">100%</span>
 </div>

 <div>
  <label for="lf1-support-descentOverride"><code>descent-override</code></label>
  <input type="range" id="lf1-support-descentOverride" min="0" max="200" value="100" step="0.1">
  <span id="lf1-support-descentOverride-value">100%</span>
 </div>

 <div>
  <label for="lf1-support-lineGapOverride"><code>line-gap-override</code></label>
  <input type="range" id="lf1-support-lineGapOverride" min="0" max="200" value="0" step="0.1">
  <span id="lf1-support-lineGapOverride-value">0%</span>
 </div>
</div>

La conf√©d√©ration BGP est une technique utilis√©e pour r√©duire le nombre de
sessions iBGP et am√©liorer le passage √† l'√©chelle dans les grands syst√®mes
autonomes (AS). Elle divise un AS en sous-AS. La plupart des r√®gles eBGP
s'appliquent entre les sous-AS, sauf que le saut suivant, la MED et les
pr√©f√©rences locales restent inchang√©s. La longueur du chemin d'AS ignore les
contributions des sous-AS de la conf√©d√©ration. La conf√©d√©ration BGP est rarement
utilis√©e et la r√©flexion des routes BGP lui est g√©n√©ralement pr√©f√©r√©e.<br>Le
remplacement d'AS est une fonctionnalit√© qui permet √† un routeur de remplacer
l'ASN d'un voisin dans le chemin d'AS des routes BGP sortantes par le sien.
C'est utile lorsque deux syst√®mes autonomes distincts partagent le m√™me ASN.
Cependant, cela interf√®re avec le m√©canisme de pr√©vention des boucles de BGP et
doit √™tre utilis√© avec prudence.
{.when-js #lf1-support-container}

## R√©sultats

Pour la police utilis√©e pour le texte de ce blog, j'obtiens la d√©finition CSS
suivante :

```css
@font-face {
  font-family: Merriweather;
  font-style: normal;
  font-weight: 400;
  src: url("../fonts/merriweather.woff2") format("woff2");
  font-display: swap;
}
@font-face {
  font-family: "Fallback for Merriweather";
  src: local("Noto Serif"), local("Droid Serif");
  size-adjust: 98.3%;
  ascent-override: 99%;
  descent-override: 27%;
}
@font-face {
  font-family: "Fallback for Merriweather";
  src: local("Georgia");
  size-adjust: 106%;
  ascent-override: 90.4%;
  descent-override: 27.3%;
}

font-family: Merriweather, "Fallback for Merriweather", serif;
```

Apr√®s un mois, la m√©trique CLS s'est bien am√©lior√©e √† 0¬†:

![Scores Core Web Vitals pour vincent.bernat.ch montrant les 6 m√©triques dans le
vert. Notamment, la m√©trique CLS √† 0.]([[!!images/core-web-vitals.svg]] "Scores
Core Web Vitals pour vincent.bernat.ch")

# √Ä propos des polices personnalis√©es

L'utilisation de [polices syst√®mes][safe web fonts] ou d'un [ensemble de
polices][modern font stack] est souvent plus simple. Cependant, je pr√©f√®re les
polices web personnalis√©es. [Merriweather][] et [Iosevka][], qui sont utilis√©es
dans ce blog, am√©liorent l'exp√©rience de lecture. Une approche alternative
serait d'utiliser Georgia comme police principale. Malheureusement, la plupart
des polices √† chasse fixe par d√©faut sont laides.

De plus, les paragraphes qui combinent des polices √† chasse variable et fixe
peuvent cr√©er une perturbation visuelle. Cela se produit en raison des
diff√©rences des m√©triques verticales ou des graisses. Pour r√©soudre ce probl√®me,
j'[ajuste les m√©triques d'Iosevka][adjust Iosevka's metrics] et sa graisse pour
les aligner avec les caract√©ristiques de Merriweather.

*[LCP]: Large Contentful Paint
*[CLS]: Cumulative Layout Shift
*[CSS]: Cascading Style Sheets

[m√©triques core web vitals]: https://web.dev/articles/defining-core-web-vitals-thresholds "Defining the Core Web Vitals metrics thresholds"
[largest contentful paint]: https://web.dev/articles/lcp "Largest Contentful Paint (LCP)"
[interaction to next paint]: https://web.dev/articles/inp "Interaction to Next Paint (INP)"
[cumulative layout shift]: https://web.dev/articles/cls "Cumulative Layout Shift (CLS)"
[safe web fonts]: https://www.cssfontstack.com/ "CSS Font Stack"
[merriweather]: https://ebensorkin.wordpress.com/ "Merriweather Font"
[iosevka]: https://typeof.net/Iosevka/ "Iosevka Font"
[size-adjust]: https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/size-adjust
[ascent-override]: https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/ascent-override
[descent-override]: https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/descent-override
[line-gap-override]: https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/line-gap-override
[improved font fallbacks]: https://developer.chrome.com/blog/font-fallbacks/
[creating perfect font fallbacks in css]: https://www.aleksandrhovhannisyan.com/blog/perfect-font-fallbacks/
[adjust iosevka's metrics]: https://github.com/vincentbernat/vincent.bernat.ch/blob/199addb942c68cbeb04c3c89a5fdee9da896785f/flake.nix#L233-L236 
[modern font stack]: https://modernfontstacks.com/ "System font stack CSS organized by typeface classification for every modern OS"
[fallback font generator]: https://screenspan.net/fallback "Reduce Cumulative Layout Shift (CLS) by adjusting web fonts and system font fallbacks using special @font-face descriptors"


