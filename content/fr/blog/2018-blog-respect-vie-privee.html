---
title: "Un blog plus respectueux de la vie priv√©e"
description: |
  Au fil des ans, j'ai apport√© des changements √† ce blog pour
  le rendre plus respectueux de la vie priv√©e.
uuid: 73594db0-0d56-40ed-9a09-32197034c735
tags:
  - web
---

Quand j'ai [commenc√© ce blog][new-site], j'ai adopt√© certains services gratuits,
comme [Disqus][] ou [Google Analytics][]. Ces services sont assez
envahissants pour la vie priv√©e des utilisateurs. Au fil des ann√©es,
j'ai essay√© de corriger cela pour arriver √† un point o√π je ne repose
plus sur aucun service ¬´ hostile ¬ª.

[TOC]

# Analyse d'audience

 - **Avant** : [Google Analytics][]
 - **Apr√®s** : rien

*Google Analytics* est la solution universelle pour obtenir
gratuitement une solution d'analyse d'audience. C'est aussi un
excellent moyen de fournir gratuitement des donn√©es sur vos visiteurs
√† Google. Il existe des solutions auto-h√©berg√©es comme [Matomo][],
[GoatCounter][] ou [Plausible][].

J'ai opt√© pour une solution plus simple : pas d'analyse
d'audience. Cela me permet aussi de penser que mon blog attire des
milliers de visiteurs par jour.

!!! "Mise √† jour (02.2019)" Concernant les traces c√¥t√© serveur, les
adresses IP sont anonymis√©es √† l'aide de [ipscrub][], un module pour
*nginx*. Toutefois, les ressources autres que HTML sont services par
[CloudFront][].

# Polices de caract√®res

 - **Avant** : [Google Fonts][]
 - **Apr√®s** : auto-h√©bergement

*Google Fonts* est une biblioth√®que de polices et un service
d'h√©bergement tr√®s populaire. Il repose sur les [r√®gles de
confidentialit√© de Google][Google Privacy Policy]. Le service
[google-webfonts-helper][] permet d'auto-h√©berger facilement n'importe
quelle police issue de *Google Fonts*. De plus, √† l'aide de
[`pyftsubset`][pyftsubset], les polices n'incluent que les caract√®res
utilis√©s dans ce blog. Les fichiers sont plus l√©gers et plus
complets : pas de probl√®me pour √©crire ¬´¬†Anton√≠n Dvo≈ô√°k¬†¬ª.

# Vid√©os

 - **Avant** : [YouTube][]
 - **Apr√®s** : auto-h√©bergement

Certains articles sont accompagn√©s par une vid√©o (comme ¬´¬†[OPL2LPT :
une carte son AdLib sur port parall√®le][OPL2LPT: an AdLib sound card
for the parallel port]¬†¬ª). Par le pass√©, j'utilisais [YouTube][],
principalement parce que c'√©tait la seule plateforme gratuite avec une
option pour d√©sactiver les publicit√©s. La diffusion de vid√©os √† la
demande est g√©n√©ralement jug√©e assez difficile. Notamment, si vous
utilisez simplement la balise `<video>`, vous risquez de servir un
fichier trop volumineux pour les personnes ayant une connexion
lente. Cependant, la difficult√© est exag√©r√©e : [hls.js][] permet de
livrer la vid√©o coup√©e en segments disponibles dans diff√©rents
d√©bits. Les utilisateurs avec Java¬≠Script d√©sactiv√© se rabattent sur
une version classique de qualit√© moyenne.

Dans ¬´¬†[Auto-h√©bergement de vid√©os avec HLS][Self-hosted videos with
HLS]¬†¬ª, j'explique cette approche plus en d√©tail.

# Commentaires

 - **Avant** : [Disqus][]
 - **Apr√®s** : auto-h√©bergement avec [Isso][]

*Disqus* est une solution de commentaires populaire pour les pages
statiques. Ils ont √©t√© r√©cemment acquis par *Zeta Global*, une soci√©t√©
de marketing dont le mod√®le √©conomique repose enti√®rement sur le
profilage. C√¥t√© technique, *Disqus* charge √©galement [plusieurs
centaines de kilo-octets de ressources][loads several hundred
kilobytes of resources]. Par cons√©quent, de nombreux sites n'activent
*Disqus* qu'√† la demande. C'est ce que je faisais. Cela ne r√©sout pas
le probl√®me de respect de la vie priv√©e. J'avais aussi le sentiment
qu'on √©tait moins d√©sireux de laisser un commentaire si une action
suppl√©mentaire √©tait requise.

!!! "Mise √† jour (01.2019)" Un an plus tard, je peux confirmer que le
nombre de commentaires a significativement augment√© apr√®s le retrait
de cette √©tape suppl√©mentaire. Entre 2011 et 2015, le site r√©coltait
environ 140 commentaires. En 2016, *Disqus* n'√©tait plus charg√©
automatiquement et le nombre de commentaires s'est retrouv√© divis√© par
deux. En 2018, apr√®s √™tre pass√© √† *Isso* et chargement automatique, il
y a eu 158 commentaires.

Pendant un certain temps, j'ai pens√© √† mettre en place mon propre
syst√®me de commentaires autour des flux Atom. Chaque page recevrait
son propre flux de commentaires. Un morceau de Java¬≠Script
transformerait ces flux en HTML et les commentaires pourraient
toujours √™tre lus sans Java¬≠Script gr√¢ce au rendu par d√©faut des
navigateurs. Les lecteurs pourraient aussi s'abonner √† ces flux : pas
besoin de notifications par courrier ! Les flux seraient servis sous
forme de fichiers statiques et mis √† jour lors de nouveaux
commentaires par un petit morceau de code c√¥t√© serveur. Encore une
fois, cela pourrait fonctionner sans JavaScript.

![Day Planner by Fowl Language Comics]([[!!images/day-planner@2x.jpg]] "<a href='https://www.fowllanguagecomics.com/comic/day-planner/'>Fowl Language Comics : Day Planner</a>. De ma difficult√© √† d√©marrer un nouveau projet.")

Je pense toujours que c'est une bonne id√©e, mais je n'avais pas envie
de d√©velopper et de maintenir un nouveau syst√®me de commentaires. Il
existe plusieurs alternatives auto-h√©berg√©s, notamment [Isso][] et
[Commento][]. *Isso* est un peu plus complet avec notamment un import
imparfait depuis *Disqus*. Les deux rencontrent des difficult√©s pour
assurer la maintenance et essaient de devenir p√©rennes via une version
h√©berg√©e payante[^hosted]. *Commento* est plus orient√© vers le respect de la
vie priv√©e avec sa non-utilisation des cookies. Cependant, les cookies
ne sont pas indispensables au bon fonctionnement d'*Isso* et ils
peuvent √™tre filtr√©s avec nginx :

    proxy_hide_header Set-Cookie;
    proxy_hide_header X-Set-Cookie;
    proxy_ignore_headers Set-Cookie;

[^hosted]: <del>Pour *Isso*, jetez un ≈ìil sur [comment.sh][].</del>
    Pour *Commento*, regardez [commento.io][].

<del>*Isso* ne propose actuellement pas de [notifications par
courrier][pr50] mais j'ai ajout√© un [flux Atom pour chaque fil de
commentaires][pr419].</del>

!!! "Mise √† jour (01.2019)" La notification par courrier a √©t√© ajout√©e
r√©cemment et je viens d'activer √† l'instant cette fonctionnalit√© ici.
J'ai √©galement d√©sactiv√© les flux Atom √©tant donn√© qu'ils n'ont jamais
√©t√© utilis√©s.

Une autre option aurait √©t√© de fermer les commentaires. Cependant,
j'ai d'excellentes contributions en commentaires et je pense aussi
qu'ils peuvent faire office de comit√© de lecture pour articles de
blog : c'est une petite garantie que le contenu n'est pas totalement
faux.

# Moteur de recherche

 - **Avant** : [Google Search][]
 - **Apr√®s** : [DuckDuckGo][]

Un moyen de fournir un moteur de recherche pour un blog personnel est
de fournir un formulaire pointant sur un moteur de recherche public,
comme Google. C'est ce que je faisais. J'ai aussi gliss√© un peu de
Java¬≠Script sur le dessus pour int√©grer l'ensemble.

La solution consiste √† passer √† [DuckDuckGo][]. Il permet de
[personnaliser][customize] un peu l'exp√©rience de recherche :

    ::html
    <form id="lf-search" action="https://duckduckgo.com/">
      <input type="hidden" name="kf" value="-1">
      <input type="hidden" name="kaf" value="1">
      <input type="hidden" name="k1" value="-1">
      <input type="hidden" name="sites" value="vincent.bernat.ch/{{ resource.meta.language }}">
      <input type="submit" value="">
      <input type="text" name="q" value="" autocomplete="off" aria-label="Search">
    </form>

La partie Java¬≠Script est supprim√©e car *DuckDuckGo* ne fournit pas
d'API. Comme il est peu probable que plus de trois personnes utilisent
le moteur de recherche dans une ann√©e, cela semble une bonne id√©e de
ne pas s'√©terniser sur cette fonctionnalit√© annexe.

# Bulletin d'information

 - **Avant** : flux RSS
 - **Apr√®s** : flux RSS <del>mais aussi une publication par courrier via [MailChimp][]</del>

De nos jours, les flux RSS sont moins populaires. Je ne comprends pas
bien cette tendance concernant le public technophile, mais certains
lecteurs pr√©f√®rent recevoir les mises √† jour par courrier
√©lectronique.

[MailChimp][] est une solution courante pour l'envoi de bulletins. Il
fournit une int√©gration simple avec les flux RSS pour d√©clencher un
courrier √† chaque mise √† jour. Du point de vue de la vie priv√©e,
MailChimp semble √™tre un bon citoyen : la collecte de donn√©es est
principalement limit√©e √† ce qui est n√©cessaire au service. Les
utilisateurs soucieux de leur vie priv√©e peuvent toujours √©viter ce
service et utiliser le [flux RSS][rss].

!!! "Mise √† jour (12.2019)" J'ai retir√© la publication via
*MailChimp*. J'avais peu d'inscrits (une quarantaine) et cela me
culpabilisait de faire de la publicit√© pour un tel service. √Ä la
place, je propose deux services permettant de recevoir des flux RSS
par courrier √©lectronique.

# Moins de Java¬≠Script

 - **Avant** : du code Java¬≠Script h√©berg√© chez des tiers
 - **Apr√®s** : du code Java¬≠Script auto-h√©berg√©

Beaucoup de personnes soucieuses de leur vie priv√©e d√©sactivent
Java¬≠Script via des extensions telles que [uMatrix][] ou
[NoScript][]. √Ä l'exception des commentaires, je n'utilisais
Java¬≠Script que pour des choses annexes :

 - rendu des formules (comme dans ¬´¬†[D√©ni de service
   TLS‚ÄØ: quelles solutions¬†?][TLS computational DoS mitigation]¬†¬ª)
 - d√©placement les notes de pied de page dans la marge quand il y a de la place[^footnote]
 - livraison am√©lior√©e des vid√©os (voir
   ¬´¬†[Auto-h√©bergement de vid√©os avec HLS][Self-hosted videos with HLS]¬†¬ª)
 - am√©lioration des galeries de photos (voir
   ¬´¬†[Installation de Debian sur un ThinkPad Edge 11‚Äù][Debian on ThinkPad Edge 11]¬†¬ª)

[^footnote]: Vous avez peut-√™tre remarqu√© mon affection
    excessive pour les notes de pied de page.

Pour les formules math√©matiques, je suis pass√© de [MathJax][] √†
[KaTeX][]. Ce dernier est plus rapide et permet le rendu c√¥t√©
serveur : il produit le m√™me r√©sultat quel que soit le navigateur. Par
cons√©quent, Java¬≠Script c√¥t√© client n'est plus n√©cessaire.

Pour les notes en marge, j'ai converti le code Java¬≠Script faisant la
transformation en Python, avec [pyquery][]. Plus de Java¬≠Script c√¥t√©
client pour cet aspect non plus.

Le code restant est toujours l√†, mais il est auto-h√©berg√©.

# M√©mento : CSP

L'en-t√™te HTTP `Content-Security-Policy` contr√¥le les resources qu'un
navigateur est autoris√© √† charger pour le rendu d'une page. Il s'agit
d'un garde-fou et d'une documentation pour les ressources externes
utilis√©es. Le mien est mod√©r√©ment complexe et montre √† quoi s'attendre
du point de vue de la protection de la vie priv√©e[^cdn] :

    Content-Security-Policy:
      {% from "nginx.j2" import csp with context %}{{ csp()|indent(6) }}

[^cdn]: Je n'ai pas de probl√®me avec l'utilisation d'un CDN comme
    [CloudFront][] : c'est un service payant et Amazon n'est pas
    une entreprise qui se sp√©cialise dans l'espionnage des
    utilisateurs.

Je suis plut√¥t satisfait d'avoir pu atteindre ce r√©sultat ! üòä

*[CDN]: Content Delivery Network

[DuckDuckGo]: https://duckduckgo.com "DuckDuckGo, the search engine that doesn't track you"
[customize]: https://duckduckgo.com/params "DuckDuckGo URL parameters"
[Google Analytics]: https://marketingplatform.google.com/about/analytics/ "Google Analytics Solutions"
[Matomo]: https://matomo.org/ "Matomo: Open Analytics Platform"
[MailChimp]: https://mailchimp.com "MailChimp"
[subscribe]: [[fr/blog/subscribe.html]] "Recevoir les mises √† jour"
[rss]: [[fr/blog/atom.xml]] "Flux RSS"
[uMatrix]: https://addons.mozilla.org/en-US/firefox/addon/umatrix/ "uMatrix addon for Firefox"
[NoScript]: https://addons.mozilla.org/en-US/firefox/addon/noscript/?src=search "NoScript addon for Firefox"
[TLS computational DoS mitigation]: [[fr/blog/2011-dos-ssl-solutions.html]] "D√©ni de service TLS‚ÄØ: quelles solutions¬†?"
[Self-hosted videos with HLS]: [[fr/blog/2018-auto-hebergement-videos.html]] "Auto-h√©bergement de vid√©os avec HLS"
[Debian on ThinkPad Edge 11]: [[fr/blog/2011-thinkpad-edge-11.html]] "Installation de Debian sur un ThinkPad Edge 11‚Äù"
[new-site]: [[fr/blog/2011-nouveau-site-avec-hyde.html]] "Nouveau site avec Hyde"
[MathJax]: https://www.mathjax.org/ "MathJax: Beautiful math in all browsers"
[KaTeX]: https://khan.github.io/KaTeX/ "KaTeX: The fastest math typesetting library for the web"
[pyquery]: https://pyquery.readthedocs.io/en/latest/ "pyquery: a jquery-like library for python"
[Google Fonts]: https://fonts.google.com/ "Google Fonts"
[Merriweather]: https://fonts.google.com/specimen/Merriweather "Merriweather font"
[Google Privacy Policy]: https://www.google.com/policies/privacy/ "Google Privacy Policy"
[google-webfonts-helper]: https://google-webfonts-helper.herokuapp.com/fonts/merriweather "A Hassle-Free Way to Self-Host Google Fonts"
[pyftsubset]: https://github.com/fonttools/fonttools "fonttools: a library to manipulate font files from Python"
[OPL2LPT: an AdLib sound card for the parallel port]: [[fr/blog/2018-adlib-opl2lpt.html]] "OPL2LPT : une carte son AdLib sur port parall√®le"
[YouTube]: https://www.youtube.com "YouTube"
[hls.js]: https://github.com/video-dev/hls.js/ "JavaScript HLS client using Media Source Extension"
[CloudFront]: https://aws.amazon.com/cloudfront/ "Amazon CloudFront global content delivery network"
[Disqus]: https://disqus.com "Disqus: blog comment hosting service"
[Google Search]: https://encrypted.google.com "Google Search"
[Isso]: https://posativ.org/isso/ "Isso: a commenting server similar to Disqus"
[Commento]: https://gitlab.com/commento/commento "Commento: a privacy-focused and bloat-free Disqus alternative"
[loads several hundred kilobytes of resources]: http://donw.io/post/github-comments/ "Replacing Disqus with Github Comments"
[pr50]: https://github.com/posativ/isso/pull/50 "Reply notification"
[pr419]: https://github.com/posativ/isso/pull/419 "api: add /feed API to get an Atom feed for a URI"
[comment.sh]: https://archive.today/2018/https://comment.sh/ "Lightweight hosted comments powered by Isso"
[commento.io]: https://commento.io/ "A privacy-focused discussion platform"
[ipscrub]: https://github.com/masonicboom/ipscrub "IP address anonymizer module for nginx"
[GoatCounter]: https://www.goatcounter.com/ "GoatCounter web analytics"
[Plausible]: https://plausible.io/ "Plausible Analytics"
